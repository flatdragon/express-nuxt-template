name: Main Workflow

on:
  push:
    branches: 
      - main

env:
  ENV: pipeline

jobs:
  test:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout Main Branch
        uses: actions/checkout@v2

      - name: Build Frontend Container
        run: docker-compose build frontend

      - name: Up Frontend Container 
        run: docker-compose up --detach frontend

      - name: Install Frontend Dependencies
        run: bash ./exec frontend_1 npm ci

      - name: Run Frontend Tests
        run: bash ./exec frontend_1 npm run test --if-present

      - name: Up Frontend Container & Run Tests
        run: docker-compose up --exit-code-from frontend
