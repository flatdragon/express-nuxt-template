version: "3.8"

services:

  frontend:
    build:
      context: ./docker/services/frontend
    environment:
      ENV: ${ENV}
      HOST: ${FRONTEND_INTERNAL_HOST:-0.0.0.0}
      PORT: ${FRONTEND_INTERNAL_PORT:-3000}
    ports:
      - ${FRONTEND_PORT:-80}:${FRONTEND_INTERNAL_PORT:-3000}
    volumes:
      - ./frontend:/app
      - ./docker/scripts:/scripts

  webhook:
    build:
      context: ./docker/services/webhook
    environment:
      DEPLOY_WEBHOOK_SECRET: ${WEBHOOK_SECRET}
    ports:
      - 4000:4000
    volumes:
      - ./webhook:/app
      - ./docker/scripts:/scripts

  tunnel:
    build:
      context: ./docker/services/tunnel
    command: lt --subdomain flatdragon-webhook --local-host webhook --port 4000
